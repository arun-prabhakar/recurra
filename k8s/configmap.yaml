apiVersion: v1
kind: ConfigMap
metadata:
  name: recurra-config
  namespace: recurra
data:
  application.yml: |
    server:
      port: 8080

    spring:
      datasource:
        url: jdbc:postgresql://postgres:5432/recurra
        username: recurra
        driver-class-name: org.postgresql.Driver
        hikari:
          maximum-pool-size: 20
          minimum-idle: 5
          connection-timeout: 30000

      jpa:
        hibernate:
          ddl-auto: validate
        properties:
          hibernate:
            dialect: org.hibernate.dialect.PostgreSQLDialect
        show-sql: false

      flyway:
        enabled: true
        locations: classpath:db/migration
        baseline-on-migrate: true

      data:
        redis:
          host: redis
          port: 6379
          timeout: 2000ms
          lettuce:
            pool:
              max-active: 20
              max-idle: 10
              min-idle: 5

    recurra:
      cache:
        enabled: true
        template-matching: true
        expire-after-write: 168h
        similarity-threshold: 0.87
        hamming-threshold: 6
        cosine-threshold: 0.15

      embeddings:
        enabled: true
        model-path: /app/models/e5-small-v2.onnx
        dimensions: 384

      proxy:
        max-retries: 3
        timeout: 60s

    logging:
      level:
        root: INFO
        com.recurra: INFO
